---
title: ã€Wagmi v2ç‰ˆã€‘wagmiã‚’ä½¿ã£ã¦Metamaskã‚’Nextjsã‚¢ãƒ—ãƒªã«ã¤ãªã„ã§ã¿ãŸã€‚
tags:
  - Next.js
  - Web3
  - METAMASK
  - wagmi
private: false
updated_at: '2024-01-25T13:43:25+09:00'
id: d0335da3c0ff025c3ffe
organization_url_name: null
slide: false
ignorePublish: false
---
ä»Šå›ã®è¨˜äº‹ã¯æ˜¨å¹´æŠ•ç¨¿ã—ãŸè¨˜äº‹ã®ä¿®æ­£ç‰ˆã§ã™ã€‚

ç§ãŒä½¿ç”¨ã—ã¦ã„ãŸwagmiãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒv2ã«ãªã‚Šå¤§å¹…ãªå¤‰æ›´ãŒã‚ã£ãŸã®ã§ãã‚Œã‚‚æ›¸ã„ã¦ãŠãã¾ã™ã€‚

# æ¦‚è¦

ã„ããªã‚Šã§ã™ãŒã€å››å¹´ç”Ÿå°‚é–€å­¦æ ¡ã®å­¦ç”Ÿã§ã‚ã‚‹ç§ã¯æœ€è¿‘æ¥å¹´ã‹ã‚‰èª²é¡Œã®æº–å‚™ã‚’ã¯ã˜ã‚ã¦ã„ã¦ã€ä»Šå›ã¯Web3å‘ã‘ã®Webã‚¢ãƒ—ãƒªã‚’é–‹ç™ºã—ã¦ã„ã“ã†ã‹ã¨æ€ã£ã¦ã„ã¾ã™ã€‚

ãªã®ã§ã¾ãšã¯ã“ã®è¨˜äº‹ã§Metamaskã®ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã‚’æ¥ç¶šã™ã‚‹ãŸã‚ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä½œã£ã¦ã„ãã¾ã™ã€‚

# wagmiã¨ã¯

https://wagmi.sh/

ä»Šå›ä½¿ç”¨ã™ã‚‹ã®ãŒã“ã¡ã‚‰ã«ãªã‚Šã¾ã™ã€‚
ã»ã‹ã«ã‚‚ã„ã‚ã„ã‚ã‚ã‚Šã¾ã™ãŒæœ€åˆã«è¦‹ã¤ã‘ãŸã®ãŒã“ã‚Œãªã®ã§ã€‚
ã‚ã¨å¯¾å¿œã—ã¦ã‚‹ã‚¦ã‚©ãƒ¬ãƒƒãƒˆãŒå¤šã„ã®ã‚‚ç†ç”±ã§ã™ã€‚

## ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
ä»Šå›ã¯
- Nextjs 13.4 
- Wagmi 2.2.1

ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

wagmi ãŒã€€v1 -> v2ã«ãªã‚Šã¾ã—ãŸã€‚

# ã„ã–å®Ÿè£…
ã¾ãšã¯wagmiã®è¨­å®šã¨ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’è¨­å®šã—ã¦ã„ãã¾ã™ã€‚

```config.ts
import { http, createConfig } from 'wagmi'
import { mainnet, sepolia } from 'wagmi/chains'

declare module 'wagmi' { 
    interface Register { 
      config: typeof config 
    } 
  } 

export const config = createConfig({
  chains: [mainnet, sepolia],
  ssr: true,
  transports: {
    [mainnet.id]: http(),
    [sepolia.id]: http(),
  },
})
```

```provider.tsx
'use client'

// for react-query and wagmi sh
// this component is client side rendered
// wagmi version2 

import { QueryClient, QueryClientProvider } from '@tanstack/react-query'
import * as React from 'react'
import { WagmiProvider } from 'wagmi'
import { config } from '../scripts/metamaskConfig'


export default function Providers(props: { children: React.ReactNode }) {
  const [queryClient] = React.useState(() => new QueryClient())

  return (
    <WagmiProvider config={config}>
      <QueryClientProvider client={queryClient}>
        {props.children}
      </QueryClientProvider>
    </WagmiProvider>
  )
}
```

WagmiConfig ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå»ƒæ­¢ã«ãªã‚Šã€WagmiProviderã«å¤‰æ›´ã«ãªã‚Šã¾ã—ãŸã€‚
ã¾ãŸ`Tansreact-query`ã®`QueryClientProvider`ã‚’å…¥ã‚Œã‚‹ã‚ˆã†ã«å¤‰æ›´ã«ãªã‚Šã¾ã—ãŸã€‚
ã¾ãŸ`Provider.tsx`ã§`"use client"`ã‚’ã¤ã‘ã¦SSRã‚’ç„¡åŠ¹åŒ–ã—ãªã„ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚ãŠãã‚‰ãã‚¦ã‚©ãƒ¬ãƒƒãƒˆã®æ¥ç¶šã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§è¡Œã†ã‹ã‚‰ã ã¨æ€ã„ã¾ã™ã€‚

```tsx
import Layout from '../layout/main';
import { ReactNode } from "react";
// chakra uiã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
import { Box, Grid, GridItem, Button, Center } from "@chakra-ui/react";
import HMeta from 'components/headmeta';
import * as React from 'react'
// wagmiã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
import { Connector, useConnect, useDisconnect, useAccount } from 'wagmi';
import Image from 'next/image';

// å¯¾å¿œã™ã‚‹ã‚¦ã‚©ãƒ¬ãƒƒãƒˆãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®å–å¾—
function WalletOption({
    connector,
    onClick,
}: {
    connector: Connector
    onClick: () => void
}) {
    const [ready, setReady] = React.useState(false)

    React.useEffect(() => {
        ; (async () => {
            const provider = await connector.getProvider()
            setReady(!!provider)
        })()
    }, [connector])

    return (
        <Box
            w={400}
            p={"20px 0px 20px 0px"}
        >
            <Center>
                <Button
                    w={200}
                    borderRadius={6}
                    disabled={!ready}
                    onClick={onClick}>
                    {connector.name}
                </Button>
            </Center>
        </Box>
    )
}

// å¯¾å¿œã™ã‚‹ã‚¦ã‚©ãƒ¬ãƒƒãƒˆãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ãƒªã‚¹ãƒˆè¡¨ç¤º
export function WalletOptions() {
    const { connectors, connect } = useConnect()

    return connectors.map((connector) => (
        <WalletOption
            key={connector.uid}
            connector={connector}
            onClick={() => connect({ connector })}
        />
    ))
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®è¡¨ç¤º

export default function Dash() {
    const account = useAccount()
    // isConnected: ã‚¦ã‚©ãƒ¬ãƒƒãƒˆãŒæ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹
    const { address, isConnected } = useAccount()
    const { disconnect } = useDisconnect()
    
    return (
        <>
            <HMeta pageTitle='Dashboard - v1' />
            <Box>
            
                {isConnected ? (
                    <div>
                        <p>addres</p>
                        <div>{address}</div>
                        <p>Wallet Provider</p>
                        <div>{account.connector.name}</div>
                        <Button onClick={() => disconnect()}>Disconnect</Button>
                        
                    </div>
                ) : (
                    <div>
                        <WalletOptions />
                    </div>
                )}
            </Box>

        </>
    )
}

Dash.getLayout = (page: ReactNode) => {
    return (
        <Layout>
            {page}
        </Layout>
    )
}
```
ä»Šå›ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‹ã‚‰å¯¾å¿œã—ã¦ã„ã‚‹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’è‡ªå‹•ã§å–å¾—ã—ã¦ãƒªã‚¹ãƒˆè¡¨ç¤ºã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

ãŸã ã—ã‚¿ã‚°ã®ä½ç½®ã‚’å·¥å¤«ã—ãªã„ã¨`Next Hydration failed`ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§æ³¨æ„ã§ã™ã€‚

# ã¾ã¨ã‚
v2ã«ãªã£ã¦ã„ããªã‚Šã‚¨ãƒ©ãƒ¼ã ã‚‰ã‘ã§ã³ã£ãã‚Šã—ã¾ã—ãŸã€‚

æ­£ç›´NextJS(SSR)ã¨ã®ç›¸æ€§ã¯ã‚ˆããªã•ãã†ã§ã™ğŸ’¦
